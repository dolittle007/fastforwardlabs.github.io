function stopGraph(){force.alpha(0)}function revolveGraph(){is_firefox||force.alpha(.03)}var rotation_speed=Math.PI/180/300;window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}();var cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.clearTimeout}();window.requestInterval=function(e,t){function a(){var o=(new Date).getTime(),r=o-i;r>=t&&(e.call(),i=(new Date).getTime()),n.value=requestAnimFrame(a)}if(!(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame&&window.mozCancelRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame))return window.setInterval(e,t);var i=(new Date).getTime(),n=new Object;return n.value=requestAnimFrame(a),n},window.clearRequestInterval=function(e){window.cancelAnimationFrame?window.cancelAnimationFrame(e.value):window.webkitCancelAnimationFrame?window.webkitCancelAnimationFrame(e.value):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(e.value):window.mozCancelRequestAnimationFrame?window.mozCancelRequestAnimationFrame(e.value):window.oCancelRequestAnimationFrame?window.oCancelRequestAnimationFrame(e.value):window.msCancelRequestAnimationFrame?window.msCancelRequestAnimationFrame(e.value):clearInterval(e)},window.requestTimeout=function(e,t){function a(){var o=(new Date).getTime(),r=o-i;r>=t?e.call():n.value=requestAnimFrame(a)}if(!(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame&&window.mozCancelRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame))return window.setTimeout(e,t);var i=(new Date).getTime(),n=new Object;return n.value=requestAnimFrame(a),n},window.clearRequestTimeout=function(e){window.cancelAnimationFrame?window.cancelAnimationFrame(e.value):window.webkitCancelAnimationFrame?window.webkitCancelAnimationFrame(e.value):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(e.value):window.mozCancelRequestAnimationFrame?window.mozCancelRequestAnimationFrame(e.value):window.oCancelRequestAnimationFrame?window.oCancelRequestAnimationFrame(e.value):window.msCancelRequestAnimationFrame?window.msCancelRequestAnimationFrame(e.value):clearTimeout(e)};var is_chrome=navigator.userAgent.indexOf("Chrome")>-1,is_explorer=navigator.userAgent.indexOf("MSIE")>-1,is_firefox=navigator.userAgent.indexOf("Firefox")>-1,is_safari=navigator.userAgent.indexOf("Safari")>-1,is_opera=navigator.userAgent.toLowerCase().indexOf("op")>-1;is_chrome&&is_safari&&(is_safari=!1),is_chrome&&is_opera&&(is_chrome=!1);var $window=$(window),width=$window.width(),height=$window.height(),no_scroll_events=!1,touch_events=!1,too_small=!1,graph_active=!0;$(document).ready(function(){function e(){var e=$(window).width();if(820>e){var t=(e-40)*C,a=t+p;if(e>640)_.not(".coming-soon").removeClass("stack").css("height",a+"px"),q.css("height",t+"px");else{var t=e*C;_.not(".coming-soon").addClass("stack").css("height","auto");var i=84;341>e&&(i=40);var t=(e-i)*g;q.css("height",t+"px")}}else _.removeClass("stack").attr("style",""),q.attr("style","")}function t(){var e=$("#content"),t=e.width(),a=e.height();k.attr("width",t),k.attr("height",a)}function a(){var e=$("#product"),t=$(".report-underline"),a=$(".report-num"),i=e.find(".content-block").first(),n=$(".blocker"),o=t.offset().top+t.height()+1,r=t.offset().left+t.width()/2;if(t.height()>36){var s=t.find(".backup-connector");r=s.offset().left+s.width()/2}var l=r,d=o-x,c=i.offset().top+i.height()-x+14,h=a.eq(0).offset().left+a.eq(0).width()/2,f=a.eq(0).offset().top-x,u=a.eq(1).offset().top-x,v=F.eq(1).offset().top+F.eq(1).height()-x+34,m=width/2,w=a.eq(2).offset().left+a.eq(0).width()/2,p=a.eq(2).offset().top-x+10,p=_.eq(2).offset().top+_.eq(2).height()-x+24,g=width/2,C=n.offset().top-x+10;A.beginPath(),A.moveTo(l,d),A.lineTo(l,c),A.lineTo(l,c),A.lineTo(h,c),A.lineTo(h,f),A.lineTo(h,u),A.lineTo(h,v),A.lineTo(w,v),A.lineTo(w,p),A.lineTo(w,p),A.lineTo(g,p),A.lineTo(g,C),A.lineWidth=2,A.lineJoin="round",A.strokeStyle="#eaeaea",A.stroke(),A.beginPath()}function i(){var e=$("#contact"),t=$(".contact-underline"),a=$(".contact-form-holder"),i=e.find(".content-block").first(),n=t.offset().top+t.height()+3,o=t.offset().left+t.width()/2;if(t.height()>36){var r=t.find(".backup-connector");o=r.offset().left+r.width()/2}var s=o,l=n-x,d=i.offset().top+i.height()-x+15,c=a.offset().left+a.outerWidth()/2,h=a.offset().top-x;A.beginPath(),A.moveTo(s,l),A.lineTo(s,d),A.lineTo(s,d),A.lineTo(c,d),A.lineTo(c,h),A.lineWidth=2,A.lineJoin="round",A.strokeStyle="#eaeaea",A.stroke()}function n(){var e=$("#team"),t=$(".team-underline"),a=$(".hilary-third"),i=e.find(".content-block").first(),n=t.offset().top+t.height()+3,o=t.offset().left+t.width()/2;if(t.height()>36){var r=t.find(".backup-connector");o=r.offset().left+r.width()/2}var s=o,l=n-x,d=a.offset().left+a.outerWidth(),c=i.offset().top+i.height()-x+8,h=a.offset().left+a.outerWidth()/2,f=a.offset().top-x+10,u=f-l;if(A.beginPath(),A.moveTo(s,l),A.lineTo(s,c),u>200){var v=a.offset().top-x-(parseInt(a.children().css("margin-bottom"))+10)/2;A.lineTo(d,c),A.lineTo(d,v),A.lineTo(h,v),A.lineTo(h,f)}else A.lineTo(h,c),A.lineTo(h,f);A.lineWidth=2,A.lineJoin="round",A.strokeStyle="#eaeaea",A.stroke()}function o(){t(),a(),i(),n()}function r(){var e=$window.width(),t=$window.height(),a=.9*t;if(e>1080)var i=360;else if(e>940)var i=280;else i=0,a=.8*t*.9;var n=.816;if(941>e)r=e,o=e*n/.92,E.css({width:r,height:o}),B.css({width:r,height:o});else{var o=a,r=.92*o/n,s=.9*(e-i);if(r>s){var l=s*n/.92;B.css({width:s,height:l})}else B.css({height:o,width:r})}}function s(){var e=$(".square"),t=e.height();e.css("width",t+"px")}function l(){500>width?(graph_active=!1,graph_paused=!0,N.addClass("paused")):(graph_paused=!1,graph_active=!0,N.removeClass("paused"),revolveGraph())}var d=$("body");/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(d.addClass("mobiley"),no_scroll_events=!0,touch_events=!0),340>width&&540>height&&(too_small=!0,d.addClass("no-graph"));var c=$("#content"),h=$("#intro");c.css("top",height);var f=c.height(),u=$("#learn-more-holder");requestTimeout(function(){no_scroll_events&&u.css("top",h.height())},0);var v=450,m=367,w=820,p=160,g=m/v,C=m/w,_=$(".report-row"),q=$(".report-side");e();var y=$(".report-image-hoverer");y.each(function(){if(!touch_events){$this=$(this);var e=$this.width()/5,t=$this.children();$this.on("mousemove",function(a){var i=$(this),n=a.pageX-i.offset().left;e>n?(t.removeClass("active"),t.eq(0).addClass("active")):2*e>n?(t.removeClass("active"),t.eq(1).addClass("active")):3*e>n?(t.removeClass("active"),t.eq(2).addClass("active")):4*e>n?(t.removeClass("active"),t.eq(3).addClass("active")):(t.removeClass("active"),t.eq(4).addClass("active"))}),$this.on("mouseleave",function(){requestTimeout(function(){t.removeClass("active"),t.eq(0).addClass("active")},200)})}});var b=$(".video-holder");b.mouseenter(function(){$(this).find("video").get(0).play()}),b.mouseleave(function(){$(this).find("video").get(0).pause()});var k=$("#content-canvas"),A=k.get(0).getContext("2d"),F=$(".report-row"),x=height;$window.bind("load",function(){o()}),$(window).resize(function(){no_scroll_events?$window.width()!=width&&(width=$window.width(),height=$window.height(),f=c.height(),c.css("top",height),r(),s(),e(),o(),l()):(width=$window.width(),height=$window.height(),f=c.height(),c.css("top",height),r(),s(),e(),o(),l())});var T=$(".section"),R=$("#nav"),M=$("#nav a"),z=$(".section-title"),D=0,O=!1,P=$(".section-link");P.on("click",function(){O=!0;var e=$(this).attr("href"),t=$(e);if("#intro"==e){var a=0;if(width>500)var i=-23;else var i=0;R.removeClass("scrolled"),graph_paused||(revolveGraph(),graph_active=!0)}else{var a=t.index(),i=t.offset().top;R.addClass("scrolled"),graph_active=!1}return no_scroll_events||(M.removeClass("active"),M.eq(a).addClass("active")),width>500?$("html, body").animate({scrollTop:i+23},200):$("html, body").animate({scrollTop:i},200),requestTimeout(function(){O=!1},300),!1});var G=$("#contact-form");G.on("submit",function(e){var t=G.serialize();G.parent().addClass("submitted"),$.ajax({type:"POST",url:G.attr("action"),data:t}).done(function(e){G.parent().removeClass("error"),G.parent().addClass("success")}).fail(function(e){G.parent().removeClass("success"),G.parent().addClass("error")}),e.preventDefault()}),$("#new-message").on("click",function(e){G.find("input[type=text], input[type=email], textarea").val(""),G.parent().removeClass("submitted"),e.preventDefault()}),$("#try-again").on("click",function(e){G.parent().removeClass("submitted"),e.preventDefault()}),no_scroll_events||M.first().addClass("active");var I=!0;$(window).on("scroll",function(){if(!O&&!no_scroll_events){var e=$(this).scrollTop();e+height/3>T.first().offset().top?$(T.get().reverse()).each(function(t){var a=$(this),i=a.offset().top;if(e+height/3>i){var n=T.length-t;return D!=n&&(M.removeClass("active"),M.eq(n).addClass("active"),D=n,R.addClass("scrolled")),!1}}):0!=D&&(M.removeClass("active"),M.first().addClass("active"),R.removeClass("scrolled"),D=0),too_small||(e>height+height/2&&f>e?I&&(graph_active=!1,I=!1):I||graph_paused||(graph_active=!0,revolveGraph(),I=!0))}});var X=$("#mc-form");X.on("submit",function(e){X.parent().addClass("submitted"),X.parent().addClass("success"),X.parent().removeClass("error")});var S=$("#whiteboard-box"),W=$("#shadow");S.on("click",function(){h.toggleClass("explaining")});var j=$("#mobile_closer");j.on("click",function(){h.removeClass("explaining")});var J=0,d=$("body"),B=$("#overlay-centerer"),E=$("#overlay-content"),H=$("#caption-content"),L=$("#close-overlay");q.on("click",function(){function e(e){w.removeClass("active"),g.removeClass("active"),g.eq(e).addClass("active"),w.eq(e).addClass("active"),touch_events&&(C=e,pane_number=g.length,m.addClass("animate"),is_safari?m.css("-webkit-transform","translate3d("+-(C/pane_number*100)+"%,0,0)"):m.css("transform","translate3d("+-(C/pane_number*100)+"%,0,0)"),requestTimeout(function(){m.removeClass("animate")},150))}function t(e){is_safari?m.css("-webkit-transform","translate3d("+e+"%,0,0)"):m.css("transform","translate3d("+e+"%,0,0)")}function a(a){if("panstart"==a.type&&(y=!1),"swipe"==a.type)e(a.deltaX>0?0==C?C:C-1:C==g.length-1?C:C+1),y=!0;else if("pan"==a.type){if(!y){var i=100*-(C/pane_number),n=parseInt(a.deltaX)/_*100;(0==C&&4==a.direction||C==g.length-1&&2==a.direction)&&(n=.5*n);var o=i+n;t(o)}}else"panend"==a.type&&(y||e(Math.abs(a.deltaX)>width/2?a.deltaX>0?0==C?C:C-1:C==g.length-1?C:C+1:C))}J=$window.scrollTop();var i=$(this),n=i.html(),o=i.find(".side-content").attr("data-info"),l=i.parents(".report-row").attr("data-num");if(i.hasClass("left"))var c="Report";else var c="Prototype";var h=i.find(".side-content").attr("data-title");d.addClass("overlayed"),r(),$window.scrollTop(0);var f='<div class="caption-num ff'+l+'">FF'+l+"</div>";if(f+='<h4 class="caption-type">'+c+"</h4>",f+='<div class="caption-title"> '+h+"</div>",f+='<div class="caption-info">'+o+"</div>",B.html(n),"Report"==c){var u='<div class="pager-holder">';u+='<div class="pager-centerer">',u+='<div class="pager square"></div>',u+='<div class="pager square"></div>',u+='<div class="pager square"></div>',u+='<div class="pager square"></div>',u+='<div class="pager square"></div>',u+="</div>",u+="</div>",B.append(u)}else{var v='<div class="seeker-holder">';v+='<div class="play-pause-holder"><div class="play-pause"></div></div>',v+='<div class="seeker-bar">',v+='<div class="seeker-progress"></div>',v+="</div>",v+="</div>",B.append(v)}if("Report"==c){var m=B.find(".report-image-hoverer"),w=B.find(".pager"),p=m.width()/5,g=m.children(),C=0,_=m.width();if(touch_events){e(0);var q=new Hammer(B.get(0)),y=!1;q.on("pan swipe panstart panend",a),q.get("swipe").set({velocity:.01})}else{m.on("mousemove",function(t){var a=$(this),i=t.pageX-a.offset().left;e(p>i?0:2*p>i?1:3*p>i?2:4*p>i?3:4)}),w.on("mouseenter",function(t){var a=$(this).index();e(a)});var b=B.find("img.active").index();w.eq(b).addClass("active")}}else{var k=B.find("video"),A=k.get(0),F=$(".seeker-bar"),x=$(".seeker-progress"),T=$(this).find("video").get(0);T.currentTime=0,k.on("timeupdate",function(){var e=A.currentTime,t=A.duration,a=100*e/t;x.css("width",a+"%")});var R=!1;F.mousedown(function(e){return R=!0,M(e.pageX),!1}),$(document).mouseup(function(e){R&&(R=!1,M(e.pageX))}),$(document).mousemove(function(e){R&&M(e.pageX)});var M=function(e){var t=A.duration,a=e-F.offset().left,i=100*a/F.width();i>100&&(i=100),0>i&&(i=0),x.css("width",i+"%"),A.currentTime=t*i/100};k.parent().on("click",function(){A.paused?(B.addClass("playing"),A.play()):(B.removeClass("playing"),A.pause())});var z=$(".play-pause");z.on("click",function(e){A.paused?(B.addClass("playing"),A.play()):(B.removeClass("playing"),A.pause())}),requestTimeout(function(){k.addClass("ready")},200),B.addClass("playing"),A.play()}s(),H.html(f),B.addClass("ff"+l)}),L.on("click",function(){B.html(""),H.html(""),B.removeClass("ff01 ff02 playing"),d.removeClass("overlayed"),$window.scrollTop(J)}),too_small||startTopicGraph();var K=27;$(document).keyup(function(e){e.keyCode==K&&(h.removeClass("explaining"),d.hasClass("overlayed")&&L.click())});var N=$("#whiteboard-control");N.on("click",function(){N.hasClass("paused")?(N.removeClass("paused"),revolveGraph(),graph_paused=!1,graph_active=!0):(N.addClass("paused"),force.alpha(0),graph_paused=!0,graph_active=!1)}),is_firefox&&d.addClass("firefox"),l()});var graph_active=!1,graph_paused=!1,revolving_interval="",force=d3.layout.force(),nodes="",startTopicGraph=function(){var e="http://techgraph.fastforwardlabs.com/api/";d3.json(e+"topics",function(t,a){var i=a;d3.json(e+"links",function(e,t){function a(e){for(var t=0;t<i.length;t++){var a=i[t];a._id==e.source_id?e.source=t:a._id==e.target_id&&(e.target=t)}return e}function n(){link_lines=w.selectAll(".link",function(e){return e._id}).data(c),link_lines.enter().append("line").attr("class","link"),link_lines.exit().remove()}function o(){labels=p.selectAll(".label_holder").data(nodes,function(e){return e._id}),labels.exit().remove();var e=labels.enter().append("div").attr("class",function(e){return e.fixed?"spacer":void 0}).classed("label_holder",!0).attr("id",function(e){return e._id}),t=e.append("div").classed("circle",!0),a=e.append("div").classed("label",!0).text(function(e){return e.name})}function r(){force.nodes(nodes).links(c).gravity(.06).size([u,v]).charge(function(e){if(e.fixed){var t=$window.width();return 500>t?-1e3:340>t?-600:-2e3}return-600}).linkDistance(120)}function s(){n(),o(),force.start()}for(var l=[[]],d=t,c=[],h=0;h<d.length;h++){var f=d[h];f=a(f),c.push(f)}for(var u=width,v=height,h=0;h<i.length;h++){var m=i[h];m.x=100*Math.random()-100+u/2,m.y=100*Math.random()-100+v/2}var w=d3.select("#techgraph-holder").append("svg").attr("id","techgraph").attr("width",u).attr("height",v),p=d3.select("#techgraph-holder").append("div").classed("label_sheet",!0);i.push({_id:"logo_spacer_0",name:"spacer",x:u/2,y:v/2,fixed:!0}),nodes=i,r(),s(),$(window).resize(function(){if(no_scroll_events){if($window.width()!=u){u=$window.width(),v=$window.height(),force.size([u,v]),w.attr("width",u).attr("height",v);var e=nodes[nodes.length-1];e.x=u/2,e.px=u/2,e.y=v/2,e.py=v/2,s()}}else{u=$window.width(),v=$window.height(),force.size([u,v]),w.attr("width",u).attr("height",v);var e=nodes[nodes.length-1];e.x=u/2,e.px=u/2,e.y=v/2,e.py=v/2,s()}}),force.on("tick",function(){is_safari?labels.style("-webkit-transform",function(e){var t=e;if(!t.fixed){var a=width/2,i=height/2,n=t.x-a,o=t.y-i,r=Math.sqrt(n*n+o*o),s=n-o*rotation_speed,l=o+n*rotation_speed,d=s+a,c=l+i;t.x=d,t.y=c}return"translate3D("+Math.floor(e.x)+"px,"+Math.floor(e.y)+"px, 0)"}):labels.style("transform",function(e){var t=e;if(!t.fixed){var a=width/2,i=height/2,n=t.x-a,o=t.y-i,r=Math.sqrt(n*n+o*o),s=n-o*rotation_speed,l=o+n*rotation_speed,d=s+a,c=l+i;t.x=d,t.y=c}return"translate3D("+Math.floor(e.x)+"px,"+Math.floor(e.y)+"px, 0)"}),link_lines.attr("x1",function(e){return Math.floor(e.source.x)}).attr("y1",function(e){return Math.floor(e.source.y)}).attr("x2",function(e){return Math.floor(e.target.x)}).attr("y2",function(e){return Math.floor(e.target.y)}),force.alpha()<.02&&graph_active&&revolveGraph()})})})};