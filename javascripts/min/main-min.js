function stopGraph(){force.alpha(0)}function revolveGraph(){is_firefox||force.alpha(.03)}var rotation_speed=Math.PI/180/300;window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}();var cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.clearTimeout}();window.requestInterval=function(e,t){function a(){var o=(new Date).getTime(),r=o-i;r>=t&&(e.call(),i=(new Date).getTime()),n.value=requestAnimFrame(a)}if(!(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame&&window.mozCancelRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame))return window.setInterval(e,t);var i=(new Date).getTime(),n=new Object;return n.value=requestAnimFrame(a),n},window.clearRequestInterval=function(e){window.cancelAnimationFrame?window.cancelAnimationFrame(e.value):window.webkitCancelAnimationFrame?window.webkitCancelAnimationFrame(e.value):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(e.value):window.mozCancelRequestAnimationFrame?window.mozCancelRequestAnimationFrame(e.value):window.oCancelRequestAnimationFrame?window.oCancelRequestAnimationFrame(e.value):window.msCancelRequestAnimationFrame?window.msCancelRequestAnimationFrame(e.value):clearInterval(e)},window.requestTimeout=function(e,t){function a(){var o=(new Date).getTime(),r=o-i;r>=t?e.call():n.value=requestAnimFrame(a)}if(!(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame&&window.mozCancelRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame))return window.setTimeout(e,t);var i=(new Date).getTime(),n=new Object;return n.value=requestAnimFrame(a),n},window.clearRequestTimeout=function(e){window.cancelAnimationFrame?window.cancelAnimationFrame(e.value):window.webkitCancelAnimationFrame?window.webkitCancelAnimationFrame(e.value):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(e.value):window.mozCancelRequestAnimationFrame?window.mozCancelRequestAnimationFrame(e.value):window.oCancelRequestAnimationFrame?window.oCancelRequestAnimationFrame(e.value):window.msCancelRequestAnimationFrame?window.msCancelRequestAnimationFrame(e.value):clearTimeout(e)};var is_chrome=navigator.userAgent.indexOf("Chrome")>-1,is_explorer=navigator.userAgent.indexOf("MSIE")>-1,is_firefox=navigator.userAgent.indexOf("Firefox")>-1,is_safari=navigator.userAgent.indexOf("Safari")>-1,is_opera=navigator.userAgent.toLowerCase().indexOf("op")>-1;is_chrome&&is_safari&&(is_safari=!1),is_chrome&&is_opera&&(is_chrome=!1);var $window=$(window),width=$window.width(),height=$window.height(),no_scroll_events=!1,touch_events=!1,too_small=!1,graph_active=!0;$(document).ready(function(){function e(){var e=$(window).width();if(820>e){var t=(e-40)*_,a=t+g;if(e>640)q.not(".coming-soon").removeClass("stack").css("height",a+"px"),y.css("height",t+"px");else{var t=e*_;q.not(".coming-soon").addClass("stack").css("height","auto");var i=84;341>e&&(i=40);var t=(e-i)*C;y.css("height",t+"px")}}else q.removeClass("stack").attr("style",""),y.attr("style","")}function t(){var e=$("#content"),t=e.width(),a=e.height();A.attr("width",t),A.attr("height",a)}function a(){var e=$("#product"),t=$(".report-underline"),a=$(".report-num"),i=e.find(".content-block").first(),n=$(".blocker"),o=t.offset().top+t.height()+1,r=t.offset().left+t.width()/2;if(t.height()>36){var s=t.find(".backup-connector");r=s.offset().left+s.width()/2}var l=r,d=o-T,c=i.offset().top+i.height()-T+18,u=a.eq(0).offset().left+a.eq(0).width()/2,f=a.eq(0).offset().top-T,h=a.eq(1).offset().top-T,v=x.eq(1).offset().top+x.eq(1).height()-T+34,m=width/2,w=a.eq(2).offset().left+a.eq(0).width()/2,p=a.eq(2).offset().top-T+10,p=q.eq(2).offset().top+q.eq(2).height()-T+24,g=width/2,C=n.offset().top-T+10;F.beginPath(),F.moveTo(l,d),F.lineTo(l,c),F.lineTo(l,c),F.lineTo(u,c),F.lineTo(u,f),F.lineTo(u,h),F.lineTo(u,v),F.lineTo(w,v),F.lineTo(w,p),F.lineTo(w,p),F.lineTo(g,p),F.lineTo(g,C),F.lineWidth=2,F.lineJoin="round",F.strokeStyle="#eaeaea",F.stroke(),F.beginPath()}function i(){var e=$("#contact"),t=$(".contact-underline"),a=$(".contact-form-holder"),i=e.find(".content-block").first(),n=t.offset().top+t.height()+3,o=t.offset().left+t.width()/2;if(t.height()>36){var r=t.find(".backup-connector");o=r.offset().left+r.width()/2}var s=o,l=n-T,d=i.offset().top+i.height()-T+20,c=a.offset().left+a.outerWidth()/2,u=a.offset().top-T;F.beginPath(),F.moveTo(s,l),F.lineTo(s,d),F.lineTo(s,d),F.lineTo(c,d),F.lineTo(c,u),F.lineWidth=2,F.lineJoin="round",F.strokeStyle="#eaeaea",F.stroke()}function n(){var e=$("#team"),t=$(".team-underline"),a=$(".hilary-third"),i=e.find(".content-block").first(),n=t.offset().top+t.height()+3,o=t.offset().left+t.width()/2;if(t.height()>36){var r=t.find(".backup-connector");o=r.offset().left+r.width()/2}var s=o,l=n-T,d=a.offset().left+a.outerWidth(),c=i.offset().top+i.height()-T+8,u=a.offset().left+a.outerWidth()/2,f=a.offset().top-T+10,h=f-l;if(F.beginPath(),F.moveTo(s,l),F.lineTo(s,c),h>200){var v=a.offset().top-T-(parseInt(a.children().css("margin-bottom"))+10)/2;F.lineTo(d,c),F.lineTo(d,v),F.lineTo(u,v),F.lineTo(u,f)}else F.lineTo(u,c),F.lineTo(u,f);F.lineWidth=2,F.lineJoin="round",F.strokeStyle="#eaeaea",F.stroke()}function o(){t(),a(),i(),n()}function r(){if(!O&&!no_scroll_events){var e=$window.scrollTop();e+height/3>R.first().offset().top?$(R.get().reverse()).each(function(t){var a=$(this),i=a.offset().top;if(e+height/3>i){var n=R.length-t;return I!=n&&(z.removeClass("active"),z.eq(n).addClass("active"),I=n,M.addClass("scrolled")),!1}}):0!=I&&(z.removeClass("active"),z.first().addClass("active"),M.removeClass("scrolled"),I=0),too_small||(e>1.25*height&&h>e?X&&(graph_active=!1,X=!1):X||graph_paused||(graph_active=!0,revolveGraph(),X=!0)),j=e}}function s(){var e=$window.width(),t=$window.height(),a=.9*t;if(e>1080)var i=360;else if(e>940)var i=280;else i=0,a=.8*t*.9;var n=.816;if(941>e)r=e,o=e*n/.92,te.css({width:r,height:o}),ee.css({width:r,height:o});else{var o=a,r=.92*o/n,s=.9*(e-i);if(r>s){var l=s*n/.92;ee.css({width:s,height:l})}else ee.css({height:o,width:r})}}function l(){var e=$(".square"),t=e.height();e.css("width",t+"px")}function d(){500>width?(graph_active=!1,graph_paused=!0,oe.addClass("paused")):(graph_paused=!1,graph_active=!0,oe.removeClass("paused"),revolveGraph())}var c=$("body");/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(c.addClass("mobiley"),no_scroll_events=!0,touch_events=!0),340>width&&540>height&&(too_small=!0,c.addClass("no-graph"));var u=$("#content"),f=$("#intro");u.css("top",height);var h=u.height(),v=$("#learn-more-holder");requestTimeout(function(){no_scroll_events&&v.css("top",f.height())},0);var m=450,w=367,p=820,g=160,C=w/m,_=w/p,q=$(".report-row"),y=$(".report-side");e();var b=$(".report-image-hoverer");b.each(function(){if(!touch_events){$this=$(this);var e=$this.width()/5,t=$this.children();$this.on("mousemove",function(a){var i=$(this),n=a.pageX-i.offset().left;e>n?(t.removeClass("active"),t.eq(0).addClass("active")):2*e>n?(t.removeClass("active"),t.eq(1).addClass("active")):3*e>n?(t.removeClass("active"),t.eq(2).addClass("active")):4*e>n?(t.removeClass("active"),t.eq(3).addClass("active")):(t.removeClass("active"),t.eq(4).addClass("active"))}),$this.on("mouseleave",function(){requestTimeout(function(){t.removeClass("active"),t.eq(0).addClass("active")},200)})}});var k=$(".video-holder");k.mouseenter(function(){$(this).find("video").get(0).play()}),k.mouseleave(function(){$(this).find("video").get(0).pause()});var A=$("#content-canvas"),F=A.get(0).getContext("2d"),x=$(".report-row"),T=height;$window.bind("load",function(){o()}),$(window).resize(function(){no_scroll_events?$window.width()!=width&&(width=$window.width(),height=$window.height(),h=u.height(),u.css("top",height),s(),l(),e(),o(),d()):(width=$window.width(),height=$window.height(),h=u.height(),u.css("top",height),s(),l(),e(),o(),d())});var R=$(".section"),M=$("#nav"),z=$("#nav a"),D=$(".section-title"),I=0,O=!1,P=$(".section-link");P.on("click",function(){O=!0;var e=$(this).attr("href"),t=$(e);if("#intro"==e){var a=0;if(width>500)var i=0;else var i=0;M.removeClass("scrolled"),graph_paused||(revolveGraph(),graph_active=!0)}else{var a=t.index(),i=t.offset().top;M.addClass("scrolled"),graph_active=!1}return no_scroll_events||(z.removeClass("active"),z.eq(a).addClass("active")),width>500?$("html, body").animate({scrollTop:i},200):$("html, body").animate({scrollTop:i},200),requestTimeout(function(){O=!1},300),!1});var G=$("#contact-form");G.on("submit",function(e){var t=G.serialize();G.parent().addClass("submitted"),$.ajax({type:"POST",url:G.attr("action"),data:t}).done(function(e){G.parent().removeClass("error"),G.parent().addClass("success")}).fail(function(e){G.parent().removeClass("success"),G.parent().addClass("error")}),e.preventDefault()}),$("#new-message").on("click",function(e){G.find("input[type=text], input[type=email], textarea").val(""),G.parent().removeClass("submitted"),e.preventDefault()}),$("#try-again").on("click",function(e){G.parent().removeClass("submitted"),e.preventDefault()}),no_scroll_events||z.first().addClass("active");var X=!0,S,W=!1;$(window).scroll(function(e){S=!0}),setInterval(function(){S&&(r(),S=!1)},250);var j=0,J=1,B=!0,E=!1,H=!1,L=!1,K=0,N=M.outerHeight(),Q=$("#mc-form");Q.on("submit",function(e){Q.parent().addClass("submitted"),Q.parent().addClass("success"),Q.parent().removeClass("error")});var U=$("#whiteboard-box"),V=$("#shadow");U.on("click",function(){f.toggleClass("explaining")});var Y=$("#mobile_closer");Y.on("click",function(){f.removeClass("explaining")});var Z=0,c=$("body"),ee=$("#overlay-centerer"),te=$("#overlay-content"),ae=$("#caption-content"),ie=$("#close-overlay");y.on("click",function(){function e(e){w.removeClass("active"),g.removeClass("active"),g.eq(e).addClass("active"),w.eq(e).addClass("active"),touch_events&&(C=e,pane_number=g.length,m.addClass("animate"),is_safari?m.css("-webkit-transform","translate3d("+-(C/pane_number*100)+"%,0,0)"):m.css("transform","translate3d("+-(C/pane_number*100)+"%,0,0)"),requestTimeout(function(){m.removeClass("animate")},150))}function t(e){is_safari?m.css("-webkit-transform","translate3d("+e+"%,0,0)"):m.css("transform","translate3d("+e+"%,0,0)")}function a(a){if("panstart"==a.type&&(y=!1),"swipe"==a.type)e(a.deltaX>0?0==C?C:C-1:C==g.length-1?C:C+1),y=!0;else if("pan"==a.type){if(!y){var i=100*-(C/pane_number),n=parseInt(a.deltaX)/_*100;(0==C&&4==a.direction||C==g.length-1&&2==a.direction)&&(n=.5*n);var o=i+n;t(o)}}else"panend"==a.type&&(y||e(Math.abs(a.deltaX)>width/2?a.deltaX>0?0==C?C:C-1:C==g.length-1?C:C+1:C))}Z=$window.scrollTop();var i=$(this),n=i.html(),o=i.find(".side-content").attr("data-info"),r=i.parents(".report-row").attr("data-num");if(i.hasClass("left"))var d="Report";else var d="Prototype";var u=i.find(".side-content").attr("data-title");c.addClass("overlayed"),s(),no_scroll_events&&(console.log("why"),$window.scrollTop(0)),requestTimeout(function(){M.addClass("scrolled"),graph_active=!1},350);var f='<div class="caption-num ff'+r+'">FF'+r+"</div>";if(f+='<h4 class="caption-type">'+d+"</h4>",f+='<div class="caption-title"> '+u+"</div>",f+='<div class="caption-info">'+o+"</div>",ee.html(n),"Report"==d){var h='<div class="pager-holder">';h+='<div class="pager-centerer">',h+='<div class="pager square"></div>',h+='<div class="pager square"></div>',h+='<div class="pager square"></div>',h+='<div class="pager square"></div>',h+='<div class="pager square"></div>',h+="</div>",h+="</div>",ee.append(h)}else{var v='<div class="seeker-holder">';v+='<div class="play-pause-holder"><div class="play-pause"></div></div>',v+='<div class="seeker-bar">',v+='<div class="seeker-progress"></div>',v+="</div>",v+="</div>",ee.append(v)}if("Report"==d){var m=ee.find(".report-image-hoverer"),w=ee.find(".pager"),p=m.width()/5,g=m.children(),C=0,_=m.width();if(touch_events){e(0);var q=new Hammer(ee.get(0)),y=!1;q.on("pan swipe panstart panend",a),q.get("swipe").set({velocity:.01})}else{m.on("mousemove",function(t){var a=$(this),i=t.pageX-a.offset().left;e(p>i?0:2*p>i?1:3*p>i?2:4*p>i?3:4)}),w.on("mouseenter",function(t){var a=$(this).index();e(a)});var b=ee.find("img.active").index();w.eq(b).addClass("active")}}else{var k=ee.find("video"),A=k.get(0),F=$(".seeker-bar"),x=$(".seeker-progress"),T=$(this).find("video").get(0);T.currentTime=0,k.on("timeupdate",function(){var e=A.currentTime,t=A.duration,a=100*e/t;x.css("width",a+"%")});var R=!1;F.mousedown(function(e){return R=!0,z(e.pageX),!1}),$(document).mouseup(function(e){R&&(R=!1,z(e.pageX))}),$(document).mousemove(function(e){R&&z(e.pageX)});var z=function(e){var t=A.duration,a=e-F.offset().left,i=100*a/F.width();i>100&&(i=100),0>i&&(i=0),x.css("width",i+"%"),A.currentTime=t*i/100};k.parent().on("click",function(){A.paused?(ee.addClass("playing"),A.play()):(ee.removeClass("playing"),A.pause())});var D=$(".play-pause");D.on("click",function(e){A.paused?(ee.addClass("playing"),A.play()):(ee.removeClass("playing"),A.pause())}),requestTimeout(function(){k.addClass("ready")},200),ee.addClass("playing"),A.play()}l(),ae.html(f),ee.addClass("ff"+r)}),ie.on("click",function(){ee.html(""),ae.html(""),ee.removeClass("ff01 ff02 playing"),c.removeClass("overlayed"),$window.scrollTop(Z)}),too_small||startTopicGraph();var ne=27;$(document).keyup(function(e){e.keyCode==ne&&(f.removeClass("explaining"),c.hasClass("overlayed")&&ie.click())});var oe=$("#whiteboard-control");oe.on("click",function(){oe.hasClass("paused")?(oe.removeClass("paused"),revolveGraph(),graph_paused=!1,graph_active=!0):(oe.addClass("paused"),force.alpha(0),graph_paused=!0,graph_active=!1)}),is_firefox&&c.addClass("firefox"),d()});var graph_active=!1,graph_paused=!1,revolving_interval="",force=d3.layout.force(),nodes="",startTopicGraph=function(){var e="http://techgraph.fastforwardlabs.com/api/";d3.json(e+"topics",function(t,a){var i=a;d3.json(e+"links",function(e,t){function a(e){for(var t=0;t<i.length;t++){var a=i[t];a._id==e.source_id?e.source=t:a._id==e.target_id&&(e.target=t)}return e}function n(){link_lines=w.selectAll(".link",function(e){return e._id}).data(c),link_lines.enter().append("line").attr("class","link"),link_lines.exit().remove()}function o(){labels=p.selectAll(".label_holder").data(nodes,function(e){return e._id}),labels.exit().remove();var e=labels.enter().append("div").attr("class",function(e){return e.fixed?"spacer":void 0}).classed("label_holder",!0).attr("id",function(e){return e._id}),t=e.append("div").classed("circle",!0),a=e.append("div").classed("label",!0).text(function(e){return e.name})}function r(){force.nodes(nodes).links(c).gravity(.06).size([h,v]).charge(function(e){if(e.fixed){var t=$window.width();return 500>t?-1e3:340>t?-600:-2e3}return-600}).linkDistance(120)}function s(){n(),o(),force.start()}for(var l=[[]],d=t,c=[],u=0;u<d.length;u++){var f=d[u];f=a(f),c.push(f)}for(var h=width,v=height,u=0;u<i.length;u++){var m=i[u];m.x=100*Math.random()-100+h/2,m.y=100*Math.random()-100+v/2}var w=d3.select("#techgraph-holder").append("svg").attr("id","techgraph").attr("width",h).attr("height",v),p=d3.select("#techgraph-holder").append("div").classed("label_sheet",!0);i.push({_id:"logo_spacer_0",name:"spacer",x:h/2,y:v/2,fixed:!0}),nodes=i,r(),s(),$(window).resize(function(){if(no_scroll_events){if($window.width()!=h){h=$window.width(),v=$window.height(),force.size([h,v]),w.attr("width",h).attr("height",v);var e=nodes[nodes.length-1];e.x=h/2,e.px=h/2,e.y=v/2,e.py=v/2,s()}}else{h=$window.width(),v=$window.height(),force.size([h,v]),w.attr("width",h).attr("height",v);var e=nodes[nodes.length-1];e.x=h/2,e.px=h/2,e.y=v/2,e.py=v/2,s()}}),force.on("tick",function(){is_safari?labels.style("-webkit-transform",function(e){var t=e;if(!t.fixed){var a=width/2,i=height/2,n=t.x-a,o=t.y-i,r=Math.sqrt(n*n+o*o),s=n-o*rotation_speed,l=o+n*rotation_speed,d=s+a,c=l+i;t.x=d,t.y=c}return"translate3D("+Math.floor(e.x)+"px,"+Math.floor(e.y)+"px, 0)"}):labels.style("transform",function(e){var t=e;if(!t.fixed){var a=width/2,i=height/2,n=t.x-a,o=t.y-i,r=Math.sqrt(n*n+o*o),s=n-o*rotation_speed,l=o+n*rotation_speed,d=s+a,c=l+i;t.x=d,t.y=c}return"translate3D("+Math.floor(e.x)+"px,"+Math.floor(e.y)+"px, 0)"}),link_lines.attr("x1",function(e){return Math.floor(e.source.x)}).attr("y1",function(e){return Math.floor(e.source.y)}).attr("x2",function(e){return Math.floor(e.target.x)}).attr("y2",function(e){return Math.floor(e.target.y)}),force.alpha()<.02&&graph_active&&revolveGraph()})})})};