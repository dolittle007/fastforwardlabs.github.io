function revolveGraph(){is_firefox||force.alpha(.03)}var rotation_speed=Math.PI/180/300;window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}();var cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.clearTimeout}();window.requestInterval=function(e,t){function i(){var o=(new Date).getTime(),r=o-a;r>=t&&(e.call(),a=(new Date).getTime()),n.value=requestAnimFrame(i)}if(!(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame&&window.mozCancelRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame))return window.setInterval(e,t);var a=(new Date).getTime(),n=new Object;return n.value=requestAnimFrame(i),n},window.clearRequestInterval=function(e){window.cancelAnimationFrame?window.cancelAnimationFrame(e.value):window.webkitCancelAnimationFrame?window.webkitCancelAnimationFrame(e.value):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(e.value):window.mozCancelRequestAnimationFrame?window.mozCancelRequestAnimationFrame(e.value):window.oCancelRequestAnimationFrame?window.oCancelRequestAnimationFrame(e.value):window.msCancelRequestAnimationFrame?window.msCancelRequestAnimationFrame(e.value):clearInterval(e)},window.requestTimeout=function(e,t){function i(){var o=(new Date).getTime(),r=o-a;r>=t?e.call():n.value=requestAnimFrame(i)}if(!(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame&&window.mozCancelRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame))return window.setTimeout(e,t);var a=(new Date).getTime(),n=new Object;return n.value=requestAnimFrame(i),n},window.clearRequestTimeout=function(e){window.cancelAnimationFrame?window.cancelAnimationFrame(e.value):window.webkitCancelAnimationFrame?window.webkitCancelAnimationFrame(e.value):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(e.value):window.mozCancelRequestAnimationFrame?window.mozCancelRequestAnimationFrame(e.value):window.oCancelRequestAnimationFrame?window.oCancelRequestAnimationFrame(e.value):window.msCancelRequestAnimationFrame?window.msCancelRequestAnimationFrame(e.value):clearTimeout(e)};var is_chrome=navigator.userAgent.indexOf("Chrome")>-1,is_explorer=navigator.userAgent.indexOf("MSIE")>-1,is_firefox=navigator.userAgent.indexOf("Firefox")>-1,is_safari=navigator.userAgent.indexOf("Safari")>-1,is_opera=navigator.userAgent.toLowerCase().indexOf("op")>-1;is_chrome&&is_safari&&(is_safari=!1),is_chrome&&is_opera&&(is_chrome=!1);var $window=$(window),width=$window.width(),height=$window.height(),no_scroll_events=!1,touch_events=!1,too_small=!1;$(document).ready(function(){function e(){var e=$(window).width();if(820>e){var t=(e-40)*g,i=t+w;if(e>640)C.not(".coming-soon").removeClass("stack").css("height",i+"px"),q.css("height",t+"px");else{var t=e*g;C.not(".coming-soon").addClass("stack").css("height","auto");var a=84;341>e&&(a=40);var t=(e-a)*p;q.css("height",t+"px")}}else C.removeClass("stack").attr("style",""),q.attr("style","")}function t(){var e=$("#content"),t=e.width(),i=e.height();b.attr("width",t),b.attr("height",i)}function i(){var e=$("#product"),t=$(".report-underline"),i=$(".report-num"),a=e.find(".content-block").first(),n=$(".blocker"),o=t.offset().top+t.height()+3,r=t.offset().left+t.width()/2;if(t.height()>30){var s=t.find(".backup-connector");r=s.offset().left+s.width()/2}var l=r,d=o-F,c=a.offset().top+a.height()-F+14,f=i.eq(0).offset().left+i.eq(0).width()/2,u=i.eq(0).offset().top-F,v=i.eq(1).offset().top-F,h=k.eq(1).offset().top+k.eq(1).height()-F+34,m=width/2,w=i.eq(2).offset().left+i.eq(0).width()/2,p=i.eq(2).offset().top-F+10,p=C.eq(2).offset().top+C.eq(2).height()-F+24,g=width/2,q=n.offset().top-F+10;A.beginPath(),A.moveTo(l,d),A.lineTo(l,c),A.lineTo(l,c),A.lineTo(f,c),A.lineTo(f,u),A.lineTo(f,v),A.lineTo(f,h),A.lineTo(w,h),A.lineTo(w,p),A.lineTo(w,p),A.lineTo(g,p),A.lineTo(g,q),A.lineWidth=2,A.lineJoin="round",A.strokeStyle="#eaeaea",A.stroke(),A.beginPath()}function a(){var e=$("#contact"),t=$(".contact-underline"),i=$(".contact-form-holder"),a=e.find(".content-block").first(),n=t.offset().top+t.height()+3,o=t.offset().left+t.width()/2;if(t.height()>30){var r=t.find(".backup-connector");o=r.offset().left+r.width()/2}var s=o,l=n-F,d=a.offset().top+a.height()-F+15,c=i.offset().left+i.outerWidth()/2,f=i.offset().top-F;A.beginPath(),A.moveTo(s,l),A.lineTo(s,d),A.lineTo(s,d),A.lineTo(c,d),A.lineTo(c,f),A.lineWidth=2,A.lineJoin="round",A.strokeStyle="#eaeaea",A.stroke()}function n(){var e=$("#team"),t=$(".team-underline"),i=$(".hilary-third"),a=e.find(".content-block").first(),n=t.offset().top+t.height()+3,o=t.offset().left+t.width()/2;if(t.height()>30){var r=t.find(".backup-connector");o=r.offset().left+r.width()/2}var s=o,l=n-F,d=i.offset().left+i.outerWidth(),c=a.offset().top+a.height()-F+8,f=i.offset().left+i.outerWidth()/2,u=i.offset().top-F+10,v=u-l;if(A.beginPath(),A.moveTo(s,l),A.lineTo(s,c),v>200){var h=i.offset().top-F-(parseInt(i.children().css("margin-bottom"))+10)/2;A.lineTo(d,c),A.lineTo(d,h),A.lineTo(f,h),A.lineTo(f,u)}else A.lineTo(f,c),A.lineTo(f,u);A.lineWidth=2,A.lineJoin="round",A.strokeStyle="#eaeaea",A.stroke()}function o(){t(),i(),a(),n()}function r(){var e=$window.width(),t=$window.height(),i=.9*t;if(e>1080)var a=360;else if(e>940)var a=280;else a=0,i=.8*t*.9;var n=.816;if(941>e)r=e,o=e*n/.92,B.css({width:r,height:o}),J.css({width:r,height:o});else{var o=i,r=.92*o/n,s=.9*(e-a);if(r>s){var l=s*n/.92;J.css({width:s,height:l})}else J.css({height:o,width:r})}}function s(){var e=$(".square"),t=e.height();e.css("width",t+"px")}var l=$("body");/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(l.addClass("mobiley"),no_scroll_events=!0,touch_events=!0),340>width&&540>height&&(too_small=!0,l.addClass("no-graph"));var d=$("#content"),c=$("#intro");d.css("top",height);var f=d.height(),u=$("#learn-more-holder");requestTimeout(function(){no_scroll_events&&u.css("top",c.height())},0);var v=450,h=367,m=820,w=160,p=h/v,g=h/m,C=$(".report-row"),q=$(".report-side");e();var _=$(".report-image-hoverer");_.each(function(){if(!touch_events){$this=$(this);var e=$this.width()/5,t=$this.children();$this.on("mousemove",function(i){var a=$(this),n=i.pageX-a.offset().left;e>n?(t.removeClass("active"),t.eq(0).addClass("active")):2*e>n?(t.removeClass("active"),t.eq(1).addClass("active")):3*e>n?(t.removeClass("active"),t.eq(2).addClass("active")):4*e>n?(t.removeClass("active"),t.eq(3).addClass("active")):(t.removeClass("active"),t.eq(4).addClass("active"))}),$this.on("mouseleave",function(){requestTimeout(function(){t.removeClass("active"),t.eq(0).addClass("active")},200)})}});var y=$(".video-holder");y.mouseenter(function(){$(this).find("video").get(0).play()}),y.mouseleave(function(){$(this).find("video").get(0).pause()});var b=$("#content-canvas"),A=b.get(0).getContext("2d"),k=$(".report-row"),F=height;$window.bind("load",function(){o()}),$(window).resize(function(){no_scroll_events?$window.width()!=width&&(width=$window.width(),height=$window.height(),f=d.height(),d.css("top",height),r(),s(),e(),o()):(width=$window.width(),height=$window.height(),f=d.height(),d.css("top",height),r(),s(),e(),o())});var T=$(".section"),x=$("#nav"),R=$("#nav a"),z=$(".section-title"),M=0,D=!1,P=$(".section-link");P.on("click",function(){D=!0;var e=$(this).attr("href"),t=$(e);if("#intro"==e){var i=0;if(width>500)var a=-23;else var a=0;x.removeClass("scrolled"),revolveGraph(),graph_active=!0}else{var i=t.index(),a=t.offset().top;x.addClass("scrolled"),graph_active=!1}return no_scroll_events||(R.removeClass("active"),R.eq(i).addClass("active")),width>500?$("html, body").animate({scrollTop:a+23},200):$("html, body").animate({scrollTop:a},200),requestTimeout(function(){D=!1},300),!1});var O=$("#contact-form");O.on("submit",function(e){var t=O.serialize();O.parent().addClass("submitted"),$.ajax({type:"POST",url:O.attr("action"),data:t}).done(function(e){O.parent().removeClass("error"),O.parent().addClass("success")}).fail(function(e){O.parent().removeClass("success"),O.parent().addClass("error")}),e.preventDefault()}),$("#new-message").on("click",function(e){O.find("input[type=text], input[type=email], textarea").val(""),O.parent().removeClass("submitted"),e.preventDefault()}),$("#try-again").on("click",function(e){O.parent().removeClass("submitted"),e.preventDefault()}),no_scroll_events||R.first().addClass("active");var j=!0;$(window).on("scroll",function(){if(!D&&!no_scroll_events){var e=$(this).scrollTop();e+height/3>T.first().offset().top?$(T.get().reverse()).each(function(t){var i=$(this),a=i.offset().top;if(e+height/3>a){var n=T.length-t;return M!=n&&(R.removeClass("active"),R.eq(n).addClass("active"),M=n,x.addClass("scrolled")),!1}}):0!=M&&(R.removeClass("active"),R.first().addClass("active"),x.removeClass("scrolled"),M=0),too_small||(e>height+height/2&&f>e?j&&(graph_active=!1,j=!1):j||(graph_active=!0,revolveGraph(),j=!0))}});var I=$("#mc-form");I.on("submit",function(e){var t=$(this);return $.ajax({type:t.attr("method"),url:t.attr("action"),data:t.serialize(),cache:!1,dataType:"jsonp",jsonp:"c",contentType:"application/json; charset=utf-8",error:function(e){alert("Could not connect to the registration server. Please try again later.")},success:function(e){I.parent().addClass("submitted"),"success"!=e.result?(console.log("failure"),I.parent().addClass("error"),I.parent().removeClass("error")):(console.log("success"),I.parent().addClass("success"),I.parent().removeClass("error"))}}),!1});var X=$("#whiteboard-box"),S=$("#shadow");X.on("click",function(){c.toggleClass("explaining")});var G=$("#mobile_closer");G.on("click",function(){c.removeClass("explaining")});var W=0,l=$("body"),J=$("#overlay-centerer"),B=$("#overlay-content"),E=$("#caption-content"),H=$("#close-overlay");q.on("click",function(){function e(e){w.removeClass("active"),g.removeClass("active"),g.eq(e).addClass("active"),w.eq(e).addClass("active"),touch_events&&(C=e,pane_number=g.length,m.addClass("animate"),is_safari?m.css("-webkit-transform","translate3d("+-(C/pane_number*100)+"%,0,0)"):m.css("transform","translate3d("+-(C/pane_number*100)+"%,0,0)"),requestTimeout(function(){m.removeClass("animate")},150))}function t(e){is_safari?m.css("-webkit-transform","translate3d("+e+"%,0,0)"):m.css("transform","translate3d("+e+"%,0,0)")}function i(i){if("panstart"==i.type&&(y=!1),"swipe"==i.type)e(i.deltaX>0?0==C?C:C-1:C==g.length-1?C:C+1),y=!0;else if("pan"==i.type){if(!y){var a=100*-(C/pane_number),n=parseInt(i.deltaX)/q*100;(0==C&&4==i.direction||C==g.length-1&&2==i.direction)&&(n=.5*n);var o=a+n;t(o)}}else"panend"==i.type&&(y||e(Math.abs(i.deltaX)>width/2?i.deltaX>0?0==C?C:C-1:C==g.length-1?C:C+1:C))}W=$window.scrollTop();var a=$(this),n=a.html(),o=a.find(".side-content").attr("data-info"),d=a.parents(".report-row").attr("data-num");if(a.hasClass("left"))var c="Report";else var c="Prototype";var f=a.find(".side-content").attr("data-title");l.addClass("overlayed"),r(),$window.scrollTop(0);var u='<div class="caption-num ff'+d+'">FF'+d+"</div>";if(u+='<h4 class="caption-type">'+c+"</h4>",u+='<div class="caption-title"> '+f+"</div>",u+='<div class="caption-info">'+o+"</div>",J.html(n),"Report"==c){var v='<div class="pager-holder">';v+='<div class="pager-centerer">',v+='<div class="pager square"></div>',v+='<div class="pager square"></div>',v+='<div class="pager square"></div>',v+='<div class="pager square"></div>',v+='<div class="pager square"></div>',v+="</div>",v+="</div>",J.append(v)}else{var h='<div class="seeker-holder">';h+='<div class="play-pause-holder"><div class="play-pause"></div></div>',h+='<div class="seeker-bar">',h+='<div class="seeker-progress"></div>',h+="</div>",h+="</div>",J.append(h)}if("Report"==c){var m=J.find(".report-image-hoverer"),w=J.find(".pager"),p=m.width()/5,g=m.children(),C=0,q=m.width();if(touch_events){e(0);var _=new Hammer(J.get(0)),y=!1;_.on("pan swipe panstart panend",i),_.get("swipe").set({velocity:.01})}else{m.on("mousemove",function(t){var i=$(this),a=t.pageX-i.offset().left;e(p>a?0:2*p>a?1:3*p>a?2:4*p>a?3:4)}),w.on("mouseenter",function(t){var i=$(this).index();e(i)});var b=J.find("img.active").index();w.eq(b).addClass("active")}}else{var A=J.find("video"),k=A.get(0),F=$(".seeker-bar"),T=$(".seeker-progress"),x=$(this).find("video").get(0);x.currentTime=0,A.on("timeupdate",function(){var e=k.currentTime,t=k.duration,i=100*e/t;T.css("width",i+"%")});var R=!1;F.mousedown(function(e){return R=!0,z(e.pageX),!1}),$(document).mouseup(function(e){R&&(R=!1,z(e.pageX))}),$(document).mousemove(function(e){R&&z(e.pageX)});var z=function(e){var t=k.duration,i=e-F.offset().left,a=100*i/F.width();a>100&&(a=100),0>a&&(a=0),T.css("width",a+"%"),k.currentTime=t*a/100};A.parent().on("click",function(){k.paused?(J.addClass("playing"),k.play()):(J.removeClass("playing"),k.pause())});var M=$(".play-pause");M.on("click",function(e){k.paused?(J.addClass("playing"),k.play()):(J.removeClass("playing"),k.pause())}),requestTimeout(function(){A.addClass("ready")},200),J.addClass("playing"),k.play()}s(),E.html(u),J.addClass("ff"+d)}),H.on("click",function(){J.html(""),E.html(""),J.removeClass("ff01 ff02 playing"),l.removeClass("overlayed"),$window.scrollTop(W)}),too_small||startTopicGraph();var L=27;$(document).keyup(function(e){e.keyCode==L&&(c.removeClass("explaining"),l.hasClass("overlayed")&&H.click())})});var graph_active=!1,revolving_interval="",force=d3.layout.force(),nodes="",startTopicGraph=function(){var e="http://techgraph.fastforwardlabs.com/api/";d3.json(e+"topics",function(t,i){var a=i;d3.json(e+"links",function(e,t){function i(e){for(var t=0;t<a.length;t++){var i=a[t];i._id==e.source_id?e.source=t:i._id==e.target_id&&(e.target=t)}return e}function n(){link_lines=w.selectAll(".link",function(e){return e._id}).data(c),link_lines.enter().append("line").attr("class","link"),link_lines.exit().remove()}function o(){labels=p.selectAll(".label_holder").data(nodes,function(e){return e._id}),labels.exit().remove();var e=labels.enter().append("div").attr("class",function(e){return e.fixed?"spacer":void 0}).classed("label_holder",!0).attr("id",function(e){return e._id}),t=e.append("div").classed("circle",!0),i=e.append("div").classed("label",!0).text(function(e){return e.name})}function r(){force.nodes(nodes).links(c).gravity(.06).size([v,h]).charge(function(e){if(e.fixed){var t=$window.width();return 500>t?-1e3:340>t?-600:-2e3}return-600}).linkDistance(120)}function s(){n(),o(),force.start()}for(var l=[[]],d=t,c=[],f=0;f<d.length;f++){var u=d[f];u=i(u),c.push(u)}for(var v=width,h=height,f=0;f<a.length;f++){var m=a[f];m.x=100*Math.random()-100+v/2,m.y=100*Math.random()-100+h/2}var w=d3.select("#techgraph-holder").append("svg").attr("id","techgraph").attr("width",v).attr("height",h),p=d3.select("#techgraph-holder").append("div").classed("label_sheet",!0);a.push({_id:"logo_spacer_0",name:"spacer",x:v/2,y:h/2,fixed:!0}),nodes=a,r(),graph_active=!0,s(),$(window).resize(function(){if(no_scroll_events){if($window.width()!=v){v=$window.width(),h=$window.height(),force.size([v,h]),w.attr("width",v).attr("height",h);var e=nodes[nodes.length-1];e.x=v/2,e.px=v/2,e.y=h/2,e.py=h/2,s()}}else{v=$window.width(),h=$window.height(),force.size([v,h]),w.attr("width",v).attr("height",h);var e=nodes[nodes.length-1];e.x=v/2,e.px=v/2,e.y=h/2,e.py=h/2,s()}}),force.on("tick",function(){is_safari?labels.style("-webkit-transform",function(e){var t=e;if(!t.fixed){var i=width/2,a=height/2,n=t.x-i,o=t.y-a,r=Math.sqrt(n*n+o*o),s=n-o*rotation_speed,l=o+n*rotation_speed,d=s+i,c=l+a;t.x=d,t.y=c}return"translate3D("+Math.floor(e.x)+"px,"+Math.floor(e.y)+"px, 0)"}):labels.style("transform",function(e){var t=e;if(!t.fixed){var i=width/2,a=height/2,n=t.x-i,o=t.y-a,r=Math.sqrt(n*n+o*o),s=n-o*rotation_speed,l=o+n*rotation_speed,d=s+i,c=l+a;t.x=d,t.y=c}return"translate3D("+Math.floor(e.x)+"px,"+Math.floor(e.y)+"px, 0)"}),link_lines.attr("x1",function(e){return Math.floor(e.source.x)}).attr("y1",function(e){return Math.floor(e.source.y)}).attr("x2",function(e){return Math.floor(e.target.x)}).attr("y2",function(e){return Math.floor(e.target.y)}),force.alpha()<.02&&graph_active&&revolveGraph()})})})};